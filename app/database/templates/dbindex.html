{% extends "base.html" %}
{% block title %}CaveDB - Database Index{% endblock %}
{% block description %}A list of regions covered by CaveDB.{% endblock %}
{% block content %}

<h1 class="mb-0 display-4">CaveDB <span class="text-muted">Regions</span></h1>

<br />

<table class="table text-center">
  <thead>
    <tr>
      <th scope="col" colspan="6">Caving Regions</th>
    </tr>

    <tr>
      <th scope="col">#</th>
      <th scope="col">Country</th>
      <th scope="col">Region</th>
      <th scope="col">Caves recorded</th>
      <th scope="col">Systems recorded</th>
      <th scope="col">Link</th>
    </tr>
  </thead>

  <tbody>
    {% for region in regions|dictsort:"country.name" %}
    <tr>
      <th scope="row">{{ forloop.counter }}</th>
      <td>{{ region.country.name }}</td>
      <td><a href="{% url 'db-region' region.slug %}" class="text-muted">{{ region.name }}</a></td>
      <td>{{ region.cave_set.all|length }}</td>
      <td>{{ region.cavesystem_set.all|length }}</td>
      <td><a href="{% url 'db-region' region.slug %}" class="text-muted">View caves</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<br /><br />

<table class="table text-center">
  <thead>
    <tr>
      <th scope="col" colspan="6">Recent Updates</th>
    </tr>

    <tr>
      <th scope="col">#</th>
      <th scope="col">Name</th>
      <th scope="col">Country</th>
      <th scope="col">Region</th>
      <th scope="col">Location</th>
      <th scope="col">Updated</th>
    </tr>
  </thead>

  <tbody>

    {% for update in recent %}
    <tr>
      <th scope="row">{{ forloop.counter }}</th>
      <td><a href="{{ update.url }}" class="text-muted">{{ update.name }}</a></td>
      <td>{{ update.country.name }}</td>
      <td>{{ update.region.name }}</td>
      <td>{{ update.location }}</td>
      <td>{{ update.updated_on|timesince }} ago</td>
    </tr>
    {% endfor %}

  </tbody>
</table>


{% endblock %}
